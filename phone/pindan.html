<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>临钢网</title>
		<meta name="description" content="临钢网全称山东临钢电子商务股份有限公司，是钢材交易的线上平台，位于山东省临沂市，临靠临沂钢材物流城，资源丰富，地理位置优越。联系电话：0539-6387606/13869993555  胡经理" />
		<meta name="keywords" content="临钢网,临钢,山东临钢,临沂临钢,钢材交易" />
		<link rel="stylesheet" type="text/css" href="font/css/font-awesome.min.css?vid=0326" />
		<link rel="stylesheet" type="text/css" href="css/swiper.min.css?vid=0326" />
		<link rel="stylesheet" type="text/css" href="./css/all.css?vid=0326" />
		<link rel="stylesheet" type="text/css" href="./css/reset.css?vid=0326" />
		<link rel="stylesheet" type="text/css" href="css/shop.css?vid=0326" />
		<link rel="stylesheet" type="text/css" href="./css/index.css?vid=0326" />
		<link rel="stylesheet" type="text/css" href="./css/quote.css?vid=0417" />
		<style type="text/css">
			.yhList{
				position: relative;
			}
			.gp-table span {
				margin: 0 0.1rem;
			}
			.subPlan{
				line-height: 30px;
				padding: 0 8px;
				border: 1px solid #FF0000;
			}
			.car-box li {
				margin-bottom: 0.2rem;
			}

			.goods-weight {
				margin-left: 0.1rem;
			}

			.planTime input {
				margin-top: 0.3rem;
				margin-bottom: 0;
			}
			.jg-type{
				width: 4rem;
				display: block;
				height: 0.6rem;
				line-height: 0.6rem;
				padding: 0 0.1rem;
				border: 1px solid #CCCCCC;
				box-sizing: border-box;
				margin-bottom: 0.05rem;
			}
			.jg-mage{
				width: 2.5rem;
				display: block;
				height: 0.6rem;
				line-height: 0.6rem;
				padding: 0 0.1rem;
				border: 1px solid #CCCCCC;
				margin-right: 0.1rem;
				margin-bottom: 0.05rem;
			}
			.set-mage{
				width: 2.1rem;
				display: block;
				height: 0.6rem;
				line-height: 0.6rem;
				padding: 0 0.1rem;
				border: 1px solid #CCCCCC;
				margin-right: 0.1rem;
				margin-top: 0.05rem;
			}
			.set-type{
				width: 4rem;
				display: block;
				height: 0.6rem;
				line-height: 0.6rem;
				padding: 0 0.1rem;
				border: 1px solid #CCCCCC;
				box-sizing: border-box;
				margin-top: 0.05rem;
			}
			.showAddress{
				border-top: 1px solid #CCCCCC;
				border-bottom: 1px solid #CCCCCC;
			}
			.showAddress span {
			    cursor: pointer;
			    color: #FF0000;
			    margin-left: 10px;
			    border: 1px solid #FF0000;
			    padding: 4px;
			    border-radius: 4px
			}
			.showAddress i{
				line-height: 24px;
			}
			.myAddress{
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				overflow-y: scroll;
				background: rgba(0,0,0,0.8);
				z-index: 99;
				display: none;
			}
			.myAddress ul{
				width: 90%;
				display: block;
				margin: 70px auto 30px;
			}
			.myAddress ul li{
				background: #FFFFFF;
				padding: 0.2rem;
				box-sizing: border-box;
				position: relative;
				border-radius: 5px;
				margin-bottom: 20px;
			}
			.myAddress .address div{
				line-height: 24px;
			}
			.shADD{
				color: #333;
				border: 1px solid #333;
			}
			.myMage {
				padding-top: 6px;
			}
			.qxPin{
				cursor: pointer;
				color: #545151;
				margin-left: 10px;
				border: 1px solid #545151;
				padding: 0 4px;
				float: right;
				line-height: 30px;
			}
			.showPin{
				cursor: pointer;
				color: #FF0000;
				margin-left: 10px;
				border: 1px solid #FF0000;
				padding: 4px;
				border-radius: 4px;
			}
			.ckht{
				position: absolute;
				top: 10px;
				right: 0;
				border:0px solid #007AFF;
				background-color: #0068A5;
				color:#ffffff;
			}	
			.myBtn{
				text-align: center;
				margin-top: 30px;
				position: fixed;
				bottom: 20px;
				width: 100%;
			}
			.myBtn a{
				display: inline-block;
				padding: 5px 10px;
				color: #6bc1fa;
				border: 1px solid #6bc1fa;
				border-radius: 4px;
			}
			.myBtn span{
				display: inline-block;
				padding: 5px 10px;
				color: #FFFFFF;
				border: 1px solid #FFFFFF;
				border-radius: 4px;
				margin-left: 30px;
				cursor: pointer;
			}	
		</style>
	</head>
	<body style="padding-top: 50px;">
		<div id="cart-head" class="show">
			<div class="cart-head">
				<a class="return" href="javascript:history.back(-1);">
					<span class="arrow-left"></span>
				</a>
				<div class="head-title">拼购</div>
				<a class="head-shop" href="tel:0539-6387606">
					<i class="fa fa-phone fa-lg"></i> &nbsp;0539-6387606
				</a>
			</div>
		</div>
		<!--列表-->
		<div class="box-list">
			<div class="cont-title">
				<ul class="main-tab">
					<li><a href="javascript:void(0)">正在拼单</a></li>
					<li class="on"><a href="javascript:void(0)">我参与的</a></li>
					<!-- <li><a href="pinAdd.html">发起拼单</a></li> -->
				</ul>
			</div>
			<div class="cont-left">
				<ul class="car-box allPinbox">

				</ul>

				<ul class="show car-box myPinbox">

				</ul>
			</div>
		</div>
		<div class="index-none">
			<p>我已经到达底线了哦\(^o^)/~</p>
		</div>
		<div class="planTime" style="display: none;">
			<h3>发布拼单</h3>
			<div class="group-time">
				<input class="need-weight" id="needWeight" type="text" name="" value="" placeholder="请填写重量(单位/吨)" />
			</div>
			<div class="planBtn">
				<i class="cPinId hidden"></i>
				<span onclick="postPin()" class="planSub">提交</span>
				<span class="planClo" onclick="planClo(this)">取消</span>
			</div>
		</div>
		<div class="myAddress">
			<ul>
				
			</ul>
			<div class="myBtn">
				<a href="user-address.html">添加新地址</a>
				<span>关闭</span>
			</div>
		</div>
		<!--底部导航-->
		<div class="footerpage"></div>

		<script src="js/jquery.min.js?vid=0326" type="text/javascript" charset="utf-8"></script>
		<script src="js/phone.js?vid=0326" type="text/javascript" charset="utf-8"></script>
		<script src="js/tools.js?vid=0326" type="text/javascript" charset="utf-8"></script>
		<script src="js/all.js?vid=0611" type="text/javascript" charset="utf-8"></script>
		<script src="js/time.js?vid=0326" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			// 倒计时
			var j = $('.gp-list').length;
			for(var i = 0;i<=j;i++){
				var timeId = 'live' + i;
				updateEndTime(timeId);
			};
		</script>
		<script type="text/javascript">
			$('.main-tab li').click(function() {
				$(this).addClass('on').siblings().removeClass('on');
				$('.cont-left ul').eq($(this).index()).addClass('show').siblings().removeClass('show');
			})

			function planClo(cal) {
				$('.planTime').hide();
			};
			function getHt(cId){
				window.open(path+"/linA/exportPdf?orderId="+cId);
			}
		</script>

		<script>
			$(function() {
				/*公共部分
				 * 导航栏
				 * footer CopyRight
				 */
				$(".footerpage").load("footer.html");
			});
		</script>
		<script type="text/javascript">
			function hidePhone(s) {
				// s = s.substring(0, 3) + "****" + s.substring(7);
				s = s.substring(0, 3) + "********";
				return s;
			}

			$(function() {
				$.ajax({
					url: path + '/linA/listpt',
					type: 'GET',
					data: {},
					dataType: 'json', //后台返回的数据类型是json文本
					success: function(result) {
						if (result != "" && result.code == 1) {
							console.log(result)
							var ptList = result.data;
							for (var i in ptList) {
								// console.log(ptList[i].orderList[i].cZjrFl)
								var ptBox =
									'<li class="gp-list"><h3 class="hidden">拼团号：<i class="pinNum">' + ptList[i].cGroupNum + '</i><i class="pinId hidden">' +
									ptList[i].detailList[0].dProductid + '</i></h3>' +
									'<div class="car-list"><div class="car-address">' +
									'<span style="font-size: 20px;">' + ptList[i].detailList[0].dStorename + '</span>' +
									'<span>剩余<b>' + ptList[i].orderList[0].cZjrFl + '</b>吨</span>'
									if(ptList[i].cState == 0){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#3549a9;margin-right:0.28rem;">待拼单</div>'
									}else if(ptList[i].cState == 1){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#ff0000;margin-right:0.28rem;">待审核</div>'
									}else if(ptList[i].cState == 2){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#69d228;margin-right:0.28rem;">初审</div>'
									}else if(ptList[i].cState == 3){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#1a8e18;margin-right:0.28rem;">已审核</div>'
									}else if(ptList[i].cState == 4){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#1ca1bf;margin-right:0.28rem;">订单完结</div>'
									}else if(ptList[i].cState == 5){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#ff0000;margin-right:0.28rem;">库存不足</div>'
									}
									ptBox +=
									'</div><div style="text-align:right;margin-bottom:5px;">剩余时间：<sapn class="settime live'+i+'" endTime="'+ ptList[i].cGroupEndTime +'"></span></div><div class="car-goods" style="padding: 0.2rem 0;">' +
									'<span>' + ptList[i].detailList[0].dShopname + '&nbsp;&nbsp;' + ptList[i].detailList[0].dShopcolumntype +
									'&nbsp;&nbsp;' + ptList[i].detailList[0].dProducttexture + '</span>' +
									'<span class="carGood-mage"><b>' + ptList[i].detailList[0].dProductspec + '</b><t class="goods-weight">' +
									ptList[i].detailList[0].dTonnum + '</t>吨</span>' +
									'<span class="carGood-price"><b class="goods-price">' + ptList[i].detailList[0].dPrice +'</b>元/吨</span></div>'+
									'<div style="margin-left:10px;">主单加工说明：'+ptList[i].detailList[0].dProcessway+'，'+ptList[i].detailList[0].dProcessrequirement+'</div>'+
									'<div style="margin:10px;">我的加工要求：</div>'+
									'<div class="clearfix"><input class="jg-type fr" id="" type="text" name="" value="" placeholder="加工要求" />'+
									'<select class="jg-mage fr"><option value ="不加工">不加工</option><option value ="开平">开平</option><option value ="分条">分条</option></select></div>'+
									'<div style="margin-top:5px;" class="clearfix"><input class="planNum" type="text" name="" id="" readonly="readonly"  id="" value="'+ptList[i].orderList[0].cZjrFl+'" /><i>/吨</i>' +
									'<span class="subPlan fr" onclick="addPin(this)">确认拼单</span></div>'+
									'</div><div class="gp-table">';
								/* for (var j in ptList[i].orderList) {
									// console.log(ptList[i].orderList[j].cRealname)
									if (j == 0) {
										ptBox +=
											'<div><div class="pingdan-hd">发起人</div>' +
											'<span>' + ptList[i].orderList[j].cRealname + '</span><span>' + hidePhone(ptList[i].orderList[j].cPhone) +
											'</span>' +
											'<span>' + ptList[i].orderList[j].cGzFl + '吨</span></div>'
									} else {
										ptBox +=
											'<div>' +
											'<span>' + ptList[i].orderList[j].cRealname + '</span><span>' + hidePhone(ptList[i].orderList[j].cPhone) +
											'</span>' +
											'<span>' + ptList[i].orderList[j].cGzFl + '吨</span></div>'
									}
								} */
								ptBox += '</div></li>'
								$('.allPinbox').append(ptBox);
							}
						}
					}
				});
				var tkn = getCookie(tk);
				$.ajax({
					url: path + '/linA/listmypt',
					type: 'GET',
					data: {},
					beforeSend: function(XMLHttpRequest) {
						XMLHttpRequest.setRequestHeader("token", tkn);
					},
					dataType: 'json', //后台返回的数据类型是json文本
					success: function(result) {
						if (result != "" && result.code == 1) {
							console.log(result)
							var ptList = result.data;
							for (var i in ptList) {
								// console.log(ptList[i].orderList[i].cZjrFl)
								var ptBox =
									'<li class="gp-list"><h3 class="hidden">拼团号：<i class="pinNum">' + ptList[i].cGroupNum + '</i><i class="pinId hidden">' +
									ptList[i].detailList[0].dProductid + '</i></h3>' +
									'<div class="car-list"><div class="car-address">' +
									'<span style="font-size: 20px;">' + ptList[i].detailList[0].dStorename + '</span>' +
									'<span>剩余<b>' + ptList[i].orderList[0].cZjrFl + '</b>吨</span>'
									if(ptList[i].cState == 0){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#3549a9;margin-right:0.28rem;">待拼单</div>'
									}else if(ptList[i].cState == 1){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#ff0000;margin-right:0.28rem;">待审核</div>'
									}else if(ptList[i].cState == 2){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#69d228;margin-right:0.28rem;">初审</div>'
									}else if(ptList[i].cState == 3){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#1a8e18;margin-right:0.28rem;">已审核</div>'
									}else if(ptList[i].cState == 4){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#1ca1bf;margin-right:0.28rem;">订单完结</div>'
									}else if(ptList[i].cState == 5){
										ptBox += 
										'<div style="display: inline-block;line-height:1rem;color:#ff0000;margin-right:0.28rem;">库存不足</div>'
									}
									ptBox +=
									'</div><div style="text-align:right;margin-bottom:5px;">剩余时间：<sapn class="settime live'+i+'" endTime="'+ ptList[i].cGroupEndTime +'"></span></div><div class="car-goods" style="padding: 0.2rem 0;">' +
									'<span>' + ptList[i].detailList[0].dShopname + '&nbsp;&nbsp;' + ptList[i].detailList[0].dShopcolumntype +
									'&nbsp;&nbsp;' + ptList[i].detailList[0].dProducttexture + '</span>' +
									'<span class="carGood-mage"><b>' + ptList[i].detailList[0].dProductspec + '</b><t class="goods-weight">' +
									ptList[i].detailList[0].dTonnum + '</t>吨</span>' +
									'<span class="carGood-price"><b class="goods-price">' + ptList[i].detailList[0].dPrice +
									'</b>元/吨</span></div></div><div class="gp-table">';
								for (var j in ptList[i].orderList) {
									// console.log(ptList[i].orderList[j].cRealname)
									if (j == 0) {
										ptBox +=
											'<div class="yhList"><div class="pingdan-hd">发起人</div>' 
											if(ptList[i].cState == 3){
												ptBox +=
												'<button class="ckht" onclick="getHt(\''+ptList[i].cId+'\')">合同下载</button>'
											}
											'<span>' + ptList[i].orderList[j].cRealname + '</span><span>' + hidePhone(ptList[i].orderList[j].cPhone) +
											'</span>' +
											'<span>' + ptList[i].orderList[j].cGzFl + '吨</span>' 
											 if(ptList[i].cState == 0){
												 ptBox +='<span class="delPin" onclick="delPin(\'' + ptList[i].cId + '\')">取消订单</span>'
											 }
											if(ptList[i].cState < 2){
												if(ptList[i].detailList[0].dProcessway == '不加工'){
													ptBox +=
													'<div class="myMage" style="margin-left:10px;">我的加工要求：'+ptList[i].detailList[0].dProcessway+'，'+ptList[i].detailList[0].dProcessrequirement+'</div><div class="clearfix"><span onclick="showSet(this)" class="showPin fr">修改加工要求</span></div></div>'+
													'<div class="clearfix changeMage hidden"><input class="set-type changeMage hidden fr" id="" type="text" name="" value="'+ptList[i].detailList[0].dProcessrequirement+'" placeholder="加工要求" />'+
													'<select class="set-mage changeMage hidden fr"><option value ="不加工">不加工</option><option value ="开平">开平</option><option value ="分条">分条</option></select></div>'+
													'<div class="changeMage hidden clearfix" style="margin:5px 0;" class="clearfix">' +
													'<span class="qxPin changeMage hidden" onclick="hideSet(this)">取消</span><span class="subPlan changeMage hidden fr"  onclick="setPin(this,\''+ptList[i].detailList[0].dId+'\')">提交</span></div>'
												}else if(ptList[i].detailList[0].dProcessway == '开平'){
													ptBox +=
													'<div class="myMage" style="margin-left:10px;">我的加工要求：'+ptList[i].detailList[0].dProcessway+'，'+ptList[i].detailList[0].dProcessrequirement+'</div><div class="clearfix"><span onclick="showSet(this)" class="showPin fr">修改加工要求</span></div></div>'+
													'<div class="clearfix changeMage hidden"><input class="set-type changeMage hidden fr" id="" type="text" name="" value="'+ptList[i].detailList[0].dProcessrequirement+'" placeholder="加工要求" />'+
													'<select class="set-mage changeMage hidden fr"><option value ="开平">开平</option><option value ="分条">分条</option><option value ="不加工">不加工</option></select></div>'+
													'<div class="changeMage hidden clearfix" style="margin:5px 0;" class="clearfix">' +
													'<span class="qxPin changeMage hidden" onclick="hideSet(this)">取消</span><span class="subPlan changeMage hidden fr"  onclick="setPin(this,\''+ptList[i].detailList[0].dId+'\')">提交</span></div>'
												}else if(ptList[i].detailList[0].dProcessway == '分条'){
													ptBox +=
													'<div class="myMage" style="margin-left:10px;">我的加工要求：'+ptList[i].detailList[0].dProcessway+'，'+ptList[i].detailList[0].dProcessrequirement+'</div><div class="clearfix"><span onclick="showSet(this)" class="showPin fr">修改加工要求</span></div></div>'+
													'<div class="clearfix changeMage hidden"><input class="set-type changeMage hidden fr" id="" type="text" name="" value="'+ptList[i].detailList[0].dProcessrequirement+'" placeholder="加工要求" />'+
													'<select class="set-mage changeMage hidden fr"><option value ="分条">分条</option><option value ="开平">开平</option><option value ="不加工">不加工</option></select></div>'+
													'<div class="changeMage hidden clearfix" style="margin:5px 0;" class="clearfix">' +
													'<span class="qxPin changeMage hidden" onclick="hideSet(this)">取消</span><span class="subPlan changeMage hidden fr"  onclick="setPin(this,\''+ptList[i].detailList[0].dId+'\')">提交</span></div>'
												}
											}else{
												ptBox +=
												'<div style="margin-left:10px;">我的加工要求：'+ptList[i].detailList[0].dProcessway+'，'+ptList[i].detailList[0].dProcessrequirement+'</div></div>'
											}
											if(ptList[i].cBlockId == ''){
												ptBox +=
												'<div class="showAddress clearfix"><span class="fr" onclick="showAddress(\''+ptList[i].cId+'\')">设置收货地址</span></div>'
											}else{
												ptBox +=
												'<div class="showAddress clearfix"><i class="fl">'+ptList[i].cProvinceId+'&nbsp;&nbsp;'+ptList[i].cCityId+'&nbsp;&nbsp;'+(ptList[i].cDistrictId == '' || ptList[i].cDistrictId ==
												null ? '' : ptList[i].cDistrictId)+'&nbsp;&nbsp;'+ptList[i].cAddressid+'</i><br><span class="fr"  onclick="showAddress(\''+ptList[i].cId+'\')">设置收货地址</span></div>'
											}
											
											//<span class="changePin" onclick="changePin(\'' + ptList[i].cId + '\')">修改</span>
									} else {
										ptBox +=
											'<div><div class="pingdan-hd"></div>' +
											'<span>' + ptList[i].orderList[j].cRealname + '</span><span>' + hidePhone(ptList[i].orderList[j].cPhone) +
											'</span>' +
											'<span>' + ptList[i].orderList[j].cGzFl + '吨</span></div>'
									}
								}
								ptBox += '</div></li>'
								$('.myPinbox').append(ptBox);
							}
						}
					}
				});

			});
			// 点击参与拼单
			function addPin(thiz) {
				var tkn = getCookie(tk);
				var myId = $(thiz).parents('li').find('.pinId').html();
				var myNum = $(thiz).parents('li').find('.pinNum').html();
				var myWeight = $(thiz).siblings('input').val();
				var detailList = [];
				var fa = {
					dProcessway:$(thiz).parents('li').find(".jg-mage").val(),
					dProcessrequirement:$(thiz).parents('li').find(".jg-type").val()
				}
				detailList.push(fa);
				var json = JSON.stringify({
					detailList:detailList,
					cTransactionId: myId,
					cCategory: 2,
					cGzFl: myWeight,
					cGroupNum: myNum
				})
				console.log(json)
				$.ajax({
					url: path + '/linA/adddd',
					type: 'POST',
					beforeSend: function(XMLHttpRequest) {
						XMLHttpRequest.setRequestHeader("token", tkn);
					},
					data: json,
					contentType: 'application/json;charset=utf-8',
					dataType: 'json', //后台返回的数据类型是json文本
					success: function(result) {
						if (result != "" && result.code == 1) {
							myProcessOk('参与成功！')
							setTimeout(function() {
								window.location.href = './pindan.html';
							}, 2000);
						} else {
							myProcessErr(result.msg)
						}
					}
				})

			}
			function showSet(thiz){
				$(thiz).hide();
				$(thiz).parents('.gp-list').find(".myMage").hide();
				$(thiz).parents('.gp-list').find(".changeMage").removeClass('hidden')
			}
			function hideSet(thiz){
				$(thiz).parents('.gp-list').find(".myMage").show();
				$(thiz).parents('.gp-list').find(".showPin").show();
				$(thiz).parents('.gp-list').find(".changeMage").addClass('hidden')
			}
			// 修改拼单
			function setPin(thiz,setId){
				var tkn = getCookie(tk);
				// var detailList = [];
				var json = {
					dId:setId,
					dProcessway:$(thiz).parents('.gp-list').find(".set-mage").val(),
					dProcessrequirement:$(thiz).parents('.gp-list').find(".set-type").val()
				}
				// detailList.push(fa);
				// var json = JSON.stringify({
				// 	detailList:detailList,
				// })
				// console.log(json)
				$.ajax({
					url: path + '/linA/upddjg',
					type:'POST',
					beforeSend: function (XMLHttpRequest) {
						XMLHttpRequest.setRequestHeader("token", tkn);
					},
					data:JSON.stringify(json),
					contentType: 'application/json;charset=utf-8',
					dataType:'json', //后台返回的数据类型是json文本
					success:function(result){
						if(result != "" && result.code == 1){
							myProcessOk('修改成功！')
							setTimeout(function() {
								window.location.href='./pindan.html?chl=my';
							}, 2000);
						}else{
							myProcessErr(result.msg)
						}
					}
				})
			
			};
			// 修改拼单数量
			function changePin(useId) {
				$('.planTime').show();
				$('.planTime .cPinId').html(useId)
			};

			function postPin() {
				var tkn = getCookie(tk);
				var myId = $('.planTime .cPinId').html();
				var newWeight = $('.need-weight').val();
				var json = JSON.stringify({
					cCategory: 2,
					cId: myId,
					cGzFl: newWeight
				})
				console.log(json)
				if (newWeight <= 0) {
					myProcessErr('请输入大于0的数字！')
				} else {
					$.ajax({
						url: path + '/linA/uppdxg',
						type: 'POST',
						beforeSend: function(XMLHttpRequest) {
							XMLHttpRequest.setRequestHeader("token", tkn);
						},
						data: json,
						contentType: 'application/json;charset=utf-8',
						dataType: 'json', //后台返回的数据类型是json文本
						success: function(result) {
							if (result != "" && result.code == 1) {
								myProcessOk('修改成功！')
								setTimeout(function() {
									window.location.href = './pindan.html';
								}, 2000);
							} else {
								myProcessErr(result.msg)
							}
						}
					})
				}
			};
			// 删除拼单
			function delPin(useId) {
				var tkn = getCookie(tk);
				var json = JSON.stringify({
					cId: useId
				})
				$.ajax({
					url: path + '/linA/upddqx',
					type: 'POST',
					beforeSend: function(XMLHttpRequest) {
						XMLHttpRequest.setRequestHeader("token", tkn);
					},
					data: json,
					contentType: 'application/json;charset=utf-8',
					dataType: 'json', //后台返回的数据类型是json文本
					success: function(result) {
						if (result != "" && result.code == 1) {
							myProcessOk('删除成功！')
							setTimeout(function() {
								window.location.href = './pindan.html';
							}, 2000);
						} else {
							myProcessErr(result.msg)
						}
					}
				})
			};
		</script>
		<script type="text/javascript">
			$(function() {
				var tkn = getCookie(tk);
				$.ajax({
					url: path + '/linA/listdz',
					type: 'GET',
					data: {},
					dataType: 'json', //后台返回的数据类型是json文本
					beforeSend: function(XMLHttpRequest) {
						XMLHttpRequest.setRequestHeader("token", tkn);
					},
					success: function(result) {
						// console.log(result)
						var point = result.address;
						for (var i in point) {
							
							var mainTbody =
							'<li><div class="address"><div>'+
							'<b>'  + point[i].cName + '</b>' +point[i].cPhone+ '</div>'+
							'<div>'+ point[i].cProvince + point[i].cCity + (point[i].cDistrict == '' || point[i].cDistrict ==
									null ? '' : point[i].cDistrict) + '</div>'+
							'<div>'+ point[i].cAddress + '</div></div>'+
							
							'<span class="shADD" onclick="chooseAdd(this,\'' + point[i].cId +'\')">选择地址</span></li>';
							$('.myAddress ul').append(mainTbody);
			
							
						}
			
					}
				})
			});
			$('.myBtn span').click(function(){
				$('.myAddress').hide();
			});
			// 显示收货地址
			function showAddress(thiz){
				$('.myAddress').show()
				$('.shADD').attr('good-id',thiz)
			}
			// 选择收货地址
			function chooseAdd(thiz,thizId){
				var tkn = getCookie(tk);
				var json = JSON.stringify({
					cBlockId:thizId,
					cId:$(thiz).attr('good-id')
				});
				console.log(json)
				
				$.ajax({
					url: path + '/linA/upddshdz',
					type: 'post',
					beforeSend: function(XMLHttpRequest) {
						XMLHttpRequest.setRequestHeader("token", tkn);
					},
					data: json,
					contentType: 'application/json;charset=utf-8',
					dataType: 'json', //后台返回的数据类型是json文本
					success: function(result) {
						if (result != "" && result.code == 1) {
							window.location.href = './pindan.html';
						} else {
							myProcessErr(result.msg)
						}
					}
				})
			}
		</script>
	</body>
</html>
